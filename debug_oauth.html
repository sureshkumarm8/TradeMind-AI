<!DOCTYPE html>
<html lang="en">
<head>
    <title>OAuth Debug Helper</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background: #f5f5f5; }
        .container { max-width: 800px; margin: 0 auto; background: white; padding: 20px; border-radius: 8px; }
        .section { margin: 20px 0; padding: 15px; border-left: 4px solid #007bff; background: #f8f9fa; }
        .error { border-left-color: #dc3545; background: #f8d7da; }
        .success { border-left-color: #28a745; background: #d4edda; }
        .warning { border-left-color: #ffc107; background: #fff3cd; }
        code { background: #e9ecef; padding: 2px 6px; border-radius: 3px; font-family: monospace; }
        button { background: #007bff; color: white; border: none; padding: 10px 20px; border-radius: 4px; cursor: pointer; }
        button:hover { background: #0056b3; }
        .info { font-size: 12px; color: #666; margin-top: 10px; }
        input[type="text"] { width: 100%; padding: 8px; margin: 5px 0; border: 1px solid #ddd; border-radius: 4px; }
        label { font-weight: bold; color: #333; display: block; margin-bottom: 5px; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîß OAuth Debug Helper for TradeMind PWA</h1>
        
        <div class="section warning">
            <h3>Current Environment Info</h3>
            <p><strong>Current URL:</strong> <code id="currentUrl"></code></p>
            <p><strong>User Agent:</strong> <code id="userAgent"></code></p>
            <p><strong>Platform:</strong> <span id="platform"></span></p>
            <p><strong>PWA Mode:</strong> <span id="pwaMode"></span></p>
            <button onclick="copyUrl()">Copy Current URL</button>
        </div>

        <div class="section">
            <h3>Test Your OAuth Client ID</h3>
            <label for="clientIdInput">OAuth Client ID:</label>
            <input type="text" id="clientIdInput" placeholder="Paste your Web OAuth Client ID here">
            <button onclick="testClientId()">Test Client ID</button>
            <div id="testResult"></div>
        </div>

        <div class="section error">
            <h3>üö® Common Causes of "invalid_client" Error</h3>
            <ol>
                <li><strong>Wrong Client ID Type:</strong> You're using an Android/iOS client ID instead of Web</li>
                <li><strong>Origin Not Authorized:</strong> Your current URL is not in "Authorized JavaScript Origins"</li>
                <li><strong>Typo in Client ID:</strong> Copy-paste error in the client ID</li>
                <li><strong>Client ID Disabled:</strong> OAuth client was disabled in Google Console</li>
                <li><strong>Wrong Google Project:</strong> Client ID is from a different Google Cloud project</li>
            </ol>
        </div>

        <div class="section success">
            <h3>‚úÖ Step-by-Step Fix</h3>
            
            <h4>Step 1: Verify Your Google Cloud Console Setup</h4>
            <ol>
                <li>Go to <a href="https://console.cloud.google.com/apis/credentials" target="_blank">Google Cloud Console - Credentials</a></li>
                <li>Click on your OAuth 2.0 Client ID</li>
                <li>Verify <strong>Application type</strong> is <code>Web application</code></li>
                <li>In <strong>Authorized JavaScript origins</strong>, add: <code id="originToCopy"></code></li>
                <li>Make sure there are <strong>NO redirect URIs</strong> (PWAs don't need them)</li>
            </ol>

            <h4>Step 2: Check OAuth Consent Screen</h4>
            <ol>
                <li>Go to <a href="https://console.cloud.google.com/apis/credentials/consent" target="_blank">OAuth Consent Screen</a></li>
                <li>Scroll to <strong>Test users</strong></li>
                <li>Add your email address</li>
                <li>Save changes</li>
            </ol>

            <h4>Step 3: Wait & Test</h4>
            <ol>
                <li>Wait 5-10 minutes for changes to propagate</li>
                <li>Clear browser cache (Android Chrome: Settings > Privacy > Clear browsing data)</li>
                <li>Test login again</li>
            </ol>
        </div>

        <div class="section">
            <h3>üîç Advanced Debugging</h3>
            <button onclick="checkGoogleAPIs()">Check Google APIs Load</button>
            <button onclick="showConsoleInfo()">Show Debug Info</button>
            <div id="debugOutput"></div>
        </div>
    </div>

    <script>
        // Initialize page
        document.addEventListener('DOMContentLoaded', function() {
            document.getElementById('currentUrl').textContent = window.location.origin;
            document.getElementById('originToCopy').textContent = window.location.origin;
            document.getElementById('userAgent').textContent = navigator.userAgent.substring(0, 100) + '...';
            
            const isAndroid = navigator.userAgent.includes('Android');
            const isPWA = window.matchMedia('(display-mode: standalone)').matches;
            
            document.getElementById('platform').textContent = isAndroid ? 'üì± Android' : 'üíª Desktop';
            document.getElementById('pwaMode').textContent = isPWA ? '‚úÖ PWA Mode (Installed)' : 'üåê Browser Tab';
        });

        function copyUrl() {
            const url = window.location.origin;
            navigator.clipboard.writeText(url).then(() => {
                alert('‚úÖ URL copied! Paste this into "Authorized JavaScript Origins" in Google Console.');
            });
        }

        function testClientId() {
            const clientId = document.getElementById('clientIdInput').value.trim();
            const result = document.getElementById('testResult');
            
            if (!clientId) {
                result.innerHTML = '<div class="section error">‚ùå Please enter a Client ID</div>';
                return;
            }

            // Basic validation
            if (!clientId.includes('.googleusercontent.com')) {
                result.innerHTML = '<div class="section error">‚ùå Invalid format. Client ID should end with .googleusercontent.com</div>';
                return;
            }

            if (clientId.includes('ANDROID') || clientId.includes('android')) {
                result.innerHTML = '<div class="section error">‚ùå This looks like an Android client ID. You need a WEB client ID for PWAs.</div>';
                return;
            }

            result.innerHTML = '<div class="section success">‚úÖ Client ID format looks correct. Try using this in your app.</div>';
        }

        function checkGoogleAPIs() {
            const output = document.getElementById('debugOutput');
            let info = '<h4>Google APIs Status:</h4><ul>';
            
            if (typeof window.gapi !== 'undefined') {
                info += '<li>‚úÖ Google API (gapi) loaded</li>';
            } else {
                info += '<li>‚ùå Google API (gapi) not loaded</li>';
            }
            
            if (typeof window.google !== 'undefined' && window.google.accounts) {
                info += '<li>‚úÖ Google Identity Services loaded</li>';
            } else {
                info += '<li>‚ùå Google Identity Services not loaded</li>';
            }
            
            info += '</ul>';
            output.innerHTML = info;
        }

        function showConsoleInfo() {
            console.clear();
            console.log('üîß TradeMind PWA OAuth Debug Info:');
            console.log('üìç Current Origin:', window.location.origin);
            console.log('üåê Full URL:', window.location.href);
            console.log('üì± User Agent:', navigator.userAgent);
            console.log('‚öôÔ∏è PWA Mode:', window.matchMedia('(display-mode: standalone)').matches);
            console.log('üîë Required in Google Console:');
            console.log('   Application Type: Web application');
            console.log('   Authorized JavaScript Origins:', window.location.origin);
            console.log('   Redirect URIs: (leave empty)');
            
            alert('‚úÖ Debug info logged to console. Press F12 to view.');
        }
    </script>
</body>
</html>
